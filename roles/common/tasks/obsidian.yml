---
- name: Download and Install Obsidian AppImage
  vars:
    obsidian_appimage_download_dir: "/opt/Obsidian"
    obsidian_appimage_url: "https://github.com/obsidianmd/obsidian-releases/releases//download/{{ obsidian_latest['tag'] }}/Obsidian-{{ obsidian_latest['tag'] | regex_replace('^v','') }}.AppImage"
    obsidian_appimage_name: "Obsidian.AppImage"
  block:
    - name: Ensure download directory exists
      file:
        path: "{{ obsidian_appimage_download_dir }}"
        state: directory

    - name: Get Obsidian latest tag 
      community.general.github_release:
        user: obsidianmd
        repo: obsidian-releases
        action: latest_release
      register: obsidian_latest 

    - name: Grab Obsidian latest binaries 
      get_url:
        url: "{{ obsidian_appimage_url }}"
        dest: "{{ obsidian_appimage_download_dir }}/{{ obsidian_appimage_name }}"
        mode: "0755"
